"use strict";const{createCanvas:createCanvas,loadImage:loadImage}=require("canvas");async function fromCanvas(t,r,a,n){const i=await loadImage(t),o=createCanvas(r,a);o.width=r,o.height=a;const e=o.getContext("2d");e.drawImage(i,0,0,r,a);const s=e.getImageData(0,0,r,a).data,c=[];let l;for(let t=0;t<a;t+=2)for(let a=0;a<r;a++){const i=4*(t*r+a),o=[s[i],s[i+1],s[i+2],s[i+3]];0===a&&(l=[],n?n(l):c.push(l)),n?n(o):l.push(o)}return c}const defaultCharList=" .,:;i1tfLCG08@",defaultColorCharList=" CGO08@",convertHtmlChars={" ":"&nbsp;"},rgbHtmlStr=(t,r,a)=>"rgb("+[t,r,a].join(",")+");";function toAscii({chars:t,isInvert:r,isHtmlColor:a,isBlock:n,isOpacity:i,isRaw:o}){let e=[];const s=(t||(a?defaultColorCharList:defaultCharList)).split("");function c(t){if(0===t.length){if(0===e.length)return;return void e.push(a?"<br/>":o?["",[]]:"\n")}const[c,l,u]=t,h=(.3*c+.59*l+.11*u)/255;let f=s.length-1-Math.round(h*(s.length-1));r&&(f=s.length-1-f);let C=s[f];a&&convertHtmlChars[C]&&(C=convertHtmlChars[C]);const g=function(t,[r,o,e,s]){if(!a)return;return"<span style='color:"+rgbHtmlStr(r,o,e)+(n?"background-color:"+rgbHtmlStr(r,o,e):"")+(i?"opacity:"+s/255+";":"")+"'>"+t+"</span>"}(C,t)||function(t,[r,a,n,i]){if(!o)return;return[t,[r,a,n,i]]}(C,t)||C;e.push(g)}function l(t){if(!Array.isArray(t))return o?JSON.stringify(e):e.join("");e=t}return{asciiChars:l,pixel:c,pixels:function(t){return t.forEach(t=>{t.forEach(t=>{c(t)}),c([])}),l()}}}async function asciiImgCanvasNodejs(t,r={}){if(!t||"string"!=typeof t)throw new TypeError("Invalid image source value: "+t);if("object"!=typeof r)throw new TypeError("Invalid options: "+r);const a=r.chars||null,n=!0===r.opacity,i=!0===r.block,o=!0===r.htmlColor,e=!0===r.invert,s=!0===r.raw,c=!1!==r.stream,l=r.height||200,u=r.width||200,h=toAscii({chars:a,isInvert:e,isBlock:i,isOpacity:n,isHtmlColor:o,isRaw:s});if(c)return await fromCanvas(t,u,l,h.pixel),h.asciiChars();const f=await fromCanvas(t,u,l);return h.pixels(f)}module.exports=asciiImgCanvasNodejs;
